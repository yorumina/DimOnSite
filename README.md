# DimOnSite — 依網站自動調整螢幕亮度（AHK v2）

這份小腳本會在你切到指定網站時，自動把筆電螢幕調暗；離開後就恢復正常亮度。看片、看動畫不刺眼，日常使用又不受影響

---

## 功能特色

* **依網站關鍵字自動調亮/調暗**：預設包含 `Netflix`、`動畫瘋`，可自行增減。
* **多瀏覽器支援**：Chrome / Edge / Firefox / Brave / Opera。
* **不重複調整**：狀態改變才下指令，避免頻繁閃爍。
* **熱鍵控制**：一鍵暫停、立即最亮/最暗。
* **安全收尾**：結束腳本時自動把亮度拉回正常值。

---

## 系統需求

* Windows 10/11（內建 PowerShell）
* AutoHotkey **v2.0**（務必 v2）
* 內建面板支援 WMI 亮度（大多數 **筆電內建螢幕** OK；外接螢幕通常不支援）

---

## 可調參數（檔案開頭）

```ahk
siteKeys := ["Netflix", "動畫瘋"] ; 命中文章/分頁標題就觸發
dim      := 1                     ; 命中時亮度（%）
normal   := 100                   ; 其他情況亮度（%）
useZero  := false                 ; true 允許 0%；false 則使用 dim
interval := 300                   ; 每隔多少毫秒檢查前景視窗
```

* **siteKeys**：以**分頁標題**模糊比對（例：加入 `"YouTube"`、`"Disney+"`）。
* **dim**：命中時的亮度下限（0–100）。
* **useZero**：設 `true` 會直接打到 **0%**（部分機型看起來像黑屏，請自行評估）。
* **normal**：離開目標網站後恢復的亮度。
* **interval**：檢查頻率，數值越小越即時、但稍增負載（300ms 很穩）。

---

## 熱鍵

* **Ctrl + Alt + ↑**：立即恢復 **normal**。
* **Ctrl + Alt + ↓**：立即切到最暗（依 `useZero` 決定是 0% 或 `dim`）。
* **Ctrl + Alt + P**：**暫停/恢復** 自動偵測（系統托盤會跳提示）。

---

## 工作原理（簡述）

* 每 `interval` 毫秒檢查**前景視窗**：抓取視窗標題與行程名稱。
* 若行程為支援的瀏覽器，且標題含任一 `siteKeys`，判定為 **dim** 狀態；否則 **normal**。
* 僅在狀態改變時呼叫 PowerShell 的 `WmiSetBrightness` 進行調整。
* 使用 `OnExit` 在腳本結束時把亮度拉回 `normal`，減少「卡暗」風險。

---

## 已知限制與小叮嚀

* **外接螢幕** 多半不吃 WMI；本腳本針對**筆電內建面板**最有效。想控制外接螢幕可改用 DDC/CI 相關工具。
* 某些品牌需安裝完整晶片組/顯示器驅動，WMI 介面才正常。
* 當網站標題沒有關鍵字（或播放器全螢幕隱去標題）時，可能無法命中；可增列更泛用的關鍵字或改高靈敏度。
* 本腳本以 `ExecutionPolicy Bypass` 呼叫 PowerShell 僅為執行單一指令，不會修改系統全域策略。

---

## 常見問題（FAQ）

**Q1：外接螢幕沒反應？**
A：正常，WMI 只管內建面板。外接螢幕需走 DDC/CI 方案。

**Q2：0% 變黑了看不到？**
A：把 `useZero` 設回 `false`，或把 `dim` 調到 1–5%。也可用 **Ctrl+Alt+↑** 立刻救回。

**Q3：我想加入別的網站？**
A：在 `siteKeys` 陣列加字串即可，例如 `["Netflix", "動畫瘋", "YouTube", "Disney+"]`。

**Q4：會不會一直閃？**
A：只有狀態變更才會調整。若仍覺得頻繁，可把 `interval` 調大。

---

---

## 更新日誌（Changelog）

### v1.1 (2025/08/24)

* 修正：當前景為**需要系統管理員權限**的應用程式時，因權限不足造成的偵測/操作錯誤。

  * 新增自動提權機制：若腳本未以系統管理員身分執行，會自動以 `*RunAs` 重新啟動自身。
  * 修正例外處理相容性（AHK v2 `catch as e`），避免出現「Invalid class」等錯誤訊息。
* 其他：提示訊息與穩定性微調（不影響既有功能）。

### v1.0 (2025/08/22)

* 原版：依網站關鍵字自動調整亮度、多瀏覽器支援、狀態變更才調整、熱鍵控制、結束時自動恢復亮度。

